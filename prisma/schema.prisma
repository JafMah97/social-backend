// D:\projects\backend\social\prisma\schema.prisma

// ------------------------------------------------------------
// Generator & Datasource
// ------------------------------------------------------------

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ------------------------------------------------------------
// User & User Role
// ------------------------------------------------------------

model User {
  // ─── Identity & Profile ─────────────────────────────
  id                String  @id @default(cuid())
  username          String  @unique
  email             String  @unique
  passwordHash      String
  fullName          String
  profileImage      String  @default("/uploads/default-avatar.png")
  coverImage        String  @default("/uploads/default-cover.jpg")
  isPrivate         Boolean @default(false)
  isProfileComplete Boolean @default(false)
  emailVerified     Boolean @default(false)



  // ─── Lifecycle & Status ─────────────────────────────
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  isActive    Boolean   @default(true)
  isBanned    Boolean   @default(false)
  banReason   String?
  lastLoginAt DateTime?
  lastIp      String?

  // ─── Role & Verification ────────────────────────────
  role          UserRole?
  verifications VerificationToken[]

  // ─── Messaging ──────────────────────────────────────
  conversationsAsUser1 Conversation[] @relation("User1Conversations")
  conversationsAsUser2 Conversation[] @relation("User2Conversations")
  sentMessages         Message[]      @relation("SenderMessages")
  receivedMessages     Message[]      @relation("RecipientMessages")
  blockedConversations Conversation[] @relation("BlockedByUser")

  // ─── Content ────────────────────────────────────────
  Post              Post[]
  Comment           Comment[]
  Like              Like[]
  SavedPost         SavedPost[]
  CommentLike       CommentLike[]
  CommentAuthorInfo CommentAuthorInfo[]

  // ─── Social Graph ───────────────────────────────────
  followers              Follow[]        @relation("Followers")
  following              Follow[]        @relation("Following")
  sentFollowRequests     FollowRequest[] @relation("SentRequests")
  receivedFollowRequests FollowRequest[] @relation("ReceivedRequests")

  // ─── Notifications ─────────────────────────────────
  notificationsReceived Notification[] @relation("Recipient")
  notificationsSent     Notification[] @relation("Actor")

  // ─── Media & Activity ──────────────────────────────
  UserMedia       UserMedia[]
  UserActivityLog UserActivityLog[]
  UserSettings    UserSettings?

  // ─── Stories ───────────────────────────────────────
  Story          Story[]
  StoryView      StoryView[]
  StoryHighlight StoryHighlight[]
  StoryLike      StoryLike[]

  // ─── Moderation ────────────────────────────────────
  Reporter Report[] @relation("Reporter")

  // ─── Indexes ───────────────────────────────────────
  @@index([username])
  @@index([email])
  @@index([fullName])
}

model UserRole {
  // ─── Identity ───────────────────────────────────────
  id     String @id @default(cuid())
  userId String @unique

  // ─── Role Assignment ────────────────────────────────
  role       Role     @default(USER)
  assignedAt DateTime @default(now())

  // ─── Relations ──────────────────────────────────────
  user User @relation(fields: [userId], references: [id])
}

enum Role {
  USER
  ADMIN
  MODERATOR
}

model UserSettings {
  // ─── Identity ───────────────────────────────────────
  id     String @id @default(cuid())
  userId String @unique

  // ─── Preferences ────────────────────────────────────
  darkMode Boolean @default(false)
  language String  @default("en")
  layout   String  @default("comfortable") // e.g. "compact", "comfortable", "grid"

  // ─── Notifications ─────────────────────────────────
  emailNotifications Boolean @default(true)
  pushNotifications  Boolean @default(true)

  // ─── Privacy ────────────────────────────────────────
  storyViewPrivacy   StoryPrivacySetting @default(EVERYONE)
  isPrivateProfile   Boolean             @default(false)
  showActivityStatus Boolean             @default(true)

  // ─── Timestamps ─────────────────────────────────────
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ─── Relations ──────────────────────────────────────
  user User @relation(fields: [userId], references: [id])
}

// ------------------------------------------------------------
// Verification Token
// ------------------------------------------------------------

model VerificationToken {
  // ─── Identity ───────────────────────────────────────
  id     String @id @default(cuid())
  userId String

  // ─── Token Details ─────────────────────────────────
  token     String           @unique
  type      VerificationType
  expiresAt DateTime
  usedAt    DateTime?

  // ─── Timestamps ────────────────────────────────────
  createdAt DateTime @default(now())

  // ─── Relations ─────────────────────────────────────
  user User @relation(fields: [userId], references: [id])
}

enum VerificationType {
  EMAIL
  PASSWORD_RESET
  TWO_FACTOR
}

// ------------------------------------------------------------
// Post
// ------------------------------------------------------------

model Post {
  // ─── Identity ───────────────────────────────────────
  id       String @id @default(cuid())
  authorId String

  // ─── Content ────────────────────────────────────────
  title       String?
  content     String?
  image       String?
  format      PostFormat     @default(TEXT)
  postType    PostType       @default(STANDARD)
  visibility  PostVisibility @default(PUBLIC)
  isSponsored Boolean        @default(false)
  startsAt    DateTime?
  endsAt      DateTime?

  // ─── Moderation ─────────────────────────────────────
  isFlagged  Boolean   @default(false)
  flagReason String?
  isDeleted  Boolean   @default(false)
  deletedAt  DateTime?

  // ─── Engagement Counters ────────────────────────────
  likesCount    Int @default(0)
  commentsCount Int @default(0)
  viewsCount    Int @default(0)

  // ─── Timestamps ─────────────────────────────────────
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ─── Relations ──────────────────────────────────────
  author        User           @relation(fields: [authorId], references: [id])
  comments      Comment[]
  likes         Like[]
  notifications Notification[]
  reports       Report[]
  savedBy       SavedPost[]
  tags          PostTag[]

  // ─── Indexes ────────────────────────────────────────
  @@index([authorId])
  @@index([createdAt])
  @@index([postType])
  @@index([title])
  @@index([content])
}

model SavedPost {
  // ─── Identity ───────────────────────────────────────
  id     String @id @default(cuid())
  userId String
  postId String

  // ─── Metadata ───────────────────────────────────────
  savedAt   DateTime  @default(now())
  isRemoved Boolean   @default(false) // Optional: for unsaving without hard delete
  removedAt DateTime?

  // ─── Snapshot (for UI caching) ──────────────────────
  postTitle  String?
  postImage  String?
  postAuthor String?

  // ─── Relations ──────────────────────────────────────
  user User @relation(fields: [userId], references: [id])
  post Post @relation(fields: [postId], references: [id])

  // ─── Indexes ────────────────────────────────────────
  @@unique([userId, postId])
  @@index([userId])
  @@index([postId])
  @@index([savedAt])
}

enum PostFormat {
  TEXT
  IMAGE
  VIDEO
  POLL
  LINK
}

enum PostType {
  STANDARD
  STORY
  REEL
  AD
}

enum PostVisibility {
  PUBLIC
  PRIVATE
  FOLLOWERS_ONLY
}

// ------------------------------------------------------------
// Tag
// ------------------------------------------------------------

model Tag {
  // ─── Identity ───────────────────────────────────────
  id   String @id @default(cuid())
  name String @unique

  // ─── Metadata ───────────────────────────────────────
  description String? // Optional: for SEO or admin notes
  isActive    Boolean @default(true) // Optional: for moderation or archiving

  // ─── Timestamps ─────────────────────────────────────
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ─── Relations ──────────────────────────────────────
  posts PostTag[]

  // ─── Indexes ────────────────────────────────────────
  @@index([name])
}

model PostTag {
  // ─── Composite Keys ─────────────────────────────────
  postId String
  tagId  String

  // ─── Relations ──────────────────────────────────────
  post Post @relation(fields: [postId], references: [id])
  tag  Tag  @relation(fields: [tagId], references: [id])

  // ─── Metadata ───────────────────────────────────────
  assignedAt DateTime @default(now()) // Optional: for analytics or audit

  // ─── Indexes ────────────────────────────────────────
  @@id([postId, tagId])
  @@index([tagId])
  @@index([postId])
}

// ------------------------------------------------------------
// Comment
// ------------------------------------------------------------

model Comment {
  // ─── Identity ───────────────────────────────────────
  id       String @id @default(cuid())
  postId   String
  authorId String

  // ─── Content ────────────────────────────────────────
  content        String
  authorUsername String? // Optional: snapshot for UI
  authorImage    String? // Optional: snapshot for UI

  // ─── Moderation ─────────────────────────────────────
  isFlagged  Boolean   @default(false)
  flagReason String?
  isDeleted  Boolean   @default(false)
  deletedAt  DateTime?

  // ─── Timestamps ─────────────────────────────────────
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ─── Relations ──────────────────────────────────────
  author            User                @relation(fields: [authorId], references: [id])
  post              Post                @relation(fields: [postId], references: [id], map: "Comment_postId_fkey_custom")
  commentLikes      CommentLike[]
  CommentAuthorInfo CommentAuthorInfo[]

  // ─── Indexes ────────────────────────────────────────
  @@index([postId])
  @@index([authorId])
  @@index([content])
}

model CommentLike {
  // ─── Identity ───────────────────────────────────────
  id        String @id @default(cuid())
  userId    String
  commentId String

  // ─── Metadata ───────────────────────────────────────
  likedAt   DateTime  @default(now())
  isRemoved Boolean   @default(false) // Optional: for undo-like or soft delete
  removedAt DateTime?

  // ─── Relations ──────────────────────────────────────
  user    User    @relation(fields: [userId], references: [id])
  comment Comment @relation(fields: [commentId], references: [id], onDelete: Cascade)

  // ─── Indexes ────────────────────────────────────────
  @@unique([userId, commentId])
  @@index([commentId])
  @@index([userId])
}

model CommentAuthorInfo {
  // ─── Identity ───────────────────────────────────────
  id        String @id @default(cuid())
  commentId String
  authorId  String

  // ─── Snapshot Metadata ──────────────────────────────
  authorUsername String? // Optional: cached for UI rendering
  authorImage    String? // Optional: avatar or profile image

  // ─── Lifecycle ──────────────────────────────────────
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  isDeleted  Boolean   @default(false)
  deletedAt  DateTime?
  isFlagged  Boolean   @default(false)
  flagReason String?

  // ─── Relations ──────────────────────────────────────
  comment Comment @relation(fields: [commentId], references: [id])
  author  User    @relation(fields: [authorId], references: [id])

  // ─── Indexes ────────────────────────────────────────
  @@index([authorId])
  @@index([commentId])
  @@index([createdAt])
}

// ------------------------------------------------------------
// Like
// ------------------------------------------------------------

model Like {
  // ─── Identity ───────────────────────────────────────
  id     String @id @default(cuid())
  userId String
  postId String

  // ─── Metadata ───────────────────────────────────────
  likedAt   DateTime  @default(now())
  isRemoved Boolean   @default(false) // Optional: for undoing likes or soft delete
  removedAt DateTime? // Optional: timestamp for when like was removed

  // ─── Relations ──────────────────────────────────────
  user User @relation(fields: [userId], references: [id])
  post Post @relation(fields: [postId], references: [id])

  // ─── Indexes ────────────────────────────────────────
  @@unique([userId, postId])
  @@index([postId])
  @@index([userId])
}

// ------------------------------------------------------------
// Follow
// ------------------------------------------------------------

model Follow {
  // ─── Identity ───────────────────────────────────────
  id          String @id @default(cuid())
  followerId  String
  followingId String

  // ─── Snapshot Metadata ──────────────────────────────
  followerUsername String?
  followerFullName String?
  followerImage    String?

  // ─── Moderation & Lifecycle ─────────────────────────
  isPending Boolean   @default(false) // for private accounts or request-based follows
  isBlocked Boolean   @default(false) // if follower is blocked
  isMuted   Boolean   @default(false) // if follower muted the following
  isRemoved Boolean   @default(false) // soft delete
  removedAt DateTime?

  // ─── Timestamps ─────────────────────────────────────
  followedAt DateTime @default(now())

  // ─── Relations ──────────────────────────────────────
  follower  User @relation("Followers", fields: [followerId], references: [id])
  following User @relation("Following", fields: [followingId], references: [id])

  // ─── Indexes ────────────────────────────────────────
  @@unique([followerId, followingId])
  @@index([followerId])
  @@index([followingId])
}

model FollowRequest {
  // ─── Identity ───────────────────────────────────────
  id         String @id @default(cuid())
  senderId   String
  receiverId String

  // ─── Status & Lifecycle ─────────────────────────────
  status      FollowRequestStatus @default(PENDING)
  sentAt      DateTime            @default(now())
  respondedAt DateTime?
  isAccepted  Boolean             @default(false)
  isRejected  Boolean             @default(false)
  isCancelled Boolean             @default(false)
  cancelledAt DateTime?

  // ─── Snapshot Metadata ──────────────────────────────
  senderUsername String?
  senderFullName String?
  senderImage    String?

  // ─── Relations ──────────────────────────────────────
  sender   User @relation("SentRequests", fields: [senderId], references: [id])
  receiver User @relation("ReceivedRequests", fields: [receiverId], references: [id])

  // ─── Indexes ────────────────────────────────────────
  @@unique([senderId, receiverId])
  @@index([senderId])
  @@index([receiverId])
}

enum FollowRequestStatus {
  PENDING
  ACCEPTED
  REJECTED
  CANCELLED
}

// ------------------------------------------------------------
// Notification Section
// ------------------------------------------------------------

enum NotificationType {
  // ─── Post & Comment ───────────────────────
  like_post
  comment
  comment_reply
  comment_liked
  post_mention
  comment_mention
  post_saved
  comment_tagged

  // ─── Story ────────────────────────────────
  story_like
  story_view
  story_reply
  story_highlighted
  story_reshared
  story_expired

  // ─── Messaging ────────────────────────────
  message
  message_reply
  message_reacted
  message_seen
  conversation_started

  // ─── Follow & Social ──────────────────────
  follow
  follow_request
  follow_accepted
  follow_declined
  mutual_follow
  profile_viewed
  suggested_to_others

  // ─── System & Admin ───────────────────────
  mention
  account_warning
  feature_announcement
  system_update
  feedback_response
  privacy_update
  security_alert
  content_flagged
}

model Notification {
  // ─── Identity ───────────────────────────────────────
  id        String  @id @default(cuid())
  userId    String // recipient
  actorId   String // initiator
  postId    String?
  storyId   String?
  messageId String?

  // ─── Content ────────────────────────────────────────
  type        NotificationType
  messageText String?
  title       String? // Optional: for UI headers
  link        String? // Optional: deep link to content
  icon        String? // Optional: icon name or URL

  // ─── Status & Lifecycle ─────────────────────────────
  isRead     Boolean   @default(false)
  readAt     DateTime?
  isArchived Boolean   @default(false)
  archivedAt DateTime?
  isDeleted  Boolean   @default(false)
  deletedAt  DateTime?

  // ─── Timestamps ─────────────────────────────────────
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ─── Relations ──────────────────────────────────────
  user    User     @relation("Recipient", fields: [userId], references: [id])
  actor   User     @relation("Actor", fields: [actorId], references: [id])
  post    Post?    @relation(fields: [postId], references: [id])
  story   Story?   @relation(fields: [storyId], references: [id])
  message Message? @relation(fields: [messageId], references: [id])

  // ─── Indexes ────────────────────────────────────────
  @@index([userId])
  @@index([actorId])
  @@index([type])
  @@index([createdAt])
  @@index([isRead])
}

// ------------------------------------------------------------
// User Media
// ------------------------------------------------------------

model UserMedia {
  // ─── Identity ───────────────────────────────────────
  id     String @id @default(cuid())
  userId String

  // ─── Content Details ────────────────────────────────
  source    String? // Optional: where it came from (e.g. "camera", "upload", "external")
  mediaType UserMediaType @default(IMAGE)
  mediaUrl  String

  // ─── Moderation & Lifecycle ─────────────────────────
  isPrivate  Boolean   @default(false)
  isFlagged  Boolean   @default(false)
  flagReason String?
  isDeleted  Boolean   @default(false)
  deletedAt  DateTime?

  // ─── Timestamps ─────────────────────────────────────
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ─── Relations ──────────────────────────────────────
  user User @relation(fields: [userId], references: [id])

  // ─── Indexes ────────────────────────────────────────
  @@index([userId])
  @@index([createdAt])
  @@index([mediaType])
}

enum UserMediaType {
  IMAGE
  VIDEO
  AUDIO
  DOCUMENT
  OTHER
}

// ------------------------------------------------------------
// User Activity Log 
// ------------------------------------------------------------
model UserActivityLog {
  // ─── Identity ───────────────────────────────────────
  id     String @id @default(cuid())
  userId String

  // ─── Activity Details ───────────────────────────────
  action    ActivityType
  metadata  Json?
  ipAddress String?
  userAgent String?

  // ─── Moderation & Lifecycle ─────────────────────────
  isFlagged  Boolean   @default(false)
  flagReason String?
  isDeleted  Boolean   @default(false)
  deletedAt  DateTime?

  // ─── Timestamps ─────────────────────────────────────
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ─── Relations ──────────────────────────────────────
  user User @relation(fields: [userId], references: [id])

  // ─── Indexes ────────────────────────────────────────
  @@index([userId])
  @@index([action])
  @@index([createdAt])
}

enum ActivityType {
  LOGIN
  LOGOUT
  POST_CREATE
  POST_DELETE
  COMMENT
  LIKE
  FOLLOW
  UNFOLLOW
  STORY_VIEW
  STORY_LIKE
  PROFILE_UPDATE
  PASSWORD_CHANGE
  MEDIA_UPLOAD
}

// ------------------------------------------------------------
// Conversations and Messages
// ------------------------------------------------------------

model Conversation {
  // ─── Identity ───────────────────────────────────────
  id          String  @id @default(cuid())
  user1Id     String
  user2Id     String
  blockedById String? // Optional: who blocked the conversation

  // ─── Lifecycle & Metadata ───────────────────────────
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  lastMessageAt DateTime?
  isBlocked     Boolean   @default(false)
  isArchived    Boolean   @default(false)
  archivedAt    DateTime?

  // ─── Relations ──────────────────────────────────────
  user1     User      @relation("User1Conversations", fields: [user1Id], references: [id])
  user2     User      @relation("User2Conversations", fields: [user2Id], references: [id])
  blockedBy User?     @relation("BlockedByUser", fields: [blockedById], references: [id])
  messages  Message[]

  // ─── Indexes ────────────────────────────────────────
  @@unique([user1Id, user2Id])
  @@index([user1Id])
  @@index([user2Id])
  @@index([lastMessageAt])
}

model Message {
  // ─── Identity ───────────────────────────────────────
  id             String @id @default(cuid())
  conversationId String
  senderId       String
  recipientId    String

  // ─── Content ────────────────────────────────────────
  content       String?
  attachmentUrl String?
  replyToId     String?

  // ─── Status & Lifecycle ─────────────────────────────
  isRead    Boolean   @default(false)
  readAt    DateTime?
  isEdited  Boolean   @default(false)
  editedAt  DateTime?
  isDeleted Boolean   @default(false)
  deletedAt DateTime?

  // ─── Timestamps ─────────────────────────────────────
  sentAt    DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ─── Relations ──────────────────────────────────────
  conversation  Conversation   @relation(fields: [conversationId], references: [id])
  sender        User           @relation("SenderMessages", fields: [senderId], references: [id])
  recipient     User           @relation("RecipientMessages", fields: [recipientId], references: [id])
  notifications Notification[]

  // ─── Indexes ────────────────────────────────────────
  @@index([conversationId])
  @@index([senderId])
  @@index([recipientId])
  @@index([sentAt])
  @@index([isRead])
}

// ------------------------------------------------------------
// Report 
// ------------------------------------------------------------

model Report {
  // ─── Identity ───────────────────────────────────────
  id           String @id @default(cuid())
  reporterId   String
  targetPostId String

  // ─── Content & Moderation ───────────────────────────
  reason      String
  status      ReportStatus @default(PENDING)
  adminNote   String? // Optional: internal moderation notes
  isResolved  Boolean      @default(false)
  resolvedAt  DateTime?
  respondedAt DateTime?

  // ─── Timestamps ─────────────────────────────────────
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ─── Relations ──────────────────────────────────────
  reporter   User @relation("Reporter", fields: [reporterId], references: [id])
  targetPost Post @relation(fields: [targetPostId], references: [id])

  // ─── Indexes ────────────────────────────────────────
  @@index([reporterId])
  @@index([targetPostId])
  @@index([status])
  @@index([createdAt])
}

enum ReportStatus {
  PENDING
  REVIEWED
  REJECTED
  ACTION_TAKEN
}

// ------------------------------------------------------------
// Story 
// ------------------------------------------------------------

model Story {
  // ─── Identity ───────────────────────────────────────
  id     String @id @default(cuid())
  userId String

  // ─── Media ──────────────────────────────────────────
  mediaUrl  String
  mediaType StoryMediaType
  caption   String?

  // ─── Snapshot Metadata ──────────────────────────────
  userUsername String
  userImage    String?

  // ─── Engagement Metrics ─────────────────────────────
  viewCount Int @default(0)
  likeCount Int @default(0)

  // ─── Optional Location ──────────────────────────────
  location String?

  // ─── Privacy & Visibility ───────────────────────────
  visibilityScope StoryVisibility @default(EVERYONE)
  isPrivate       Boolean         @default(false)

  // ─── Moderation & Lifecycle ─────────────────────────
  isFlagged  Boolean   @default(false)
  flagReason String?
  isDeleted  Boolean   @default(false)
  deletedAt  DateTime?

  // ─── Timestamps ─────────────────────────────────────
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  expiresAt DateTime

  // ─── Relations ──────────────────────────────────────
  user          User             @relation(fields: [userId], references: [id])
  views         StoryView[]
  highlights    StoryHighlight[]
  likes         StoryLike[]
  notifications Notification[]

  // ─── Indexes ────────────────────────────────────────
  @@index([userId])
  @@index([expiresAt])
  @@index([mediaType])
  @@index([visibilityScope])
}

enum StoryMediaType {
  IMAGE
  VIDEO
  AUDIO
}

enum StoryPrivacySetting {
  EVERYONE
  FOLLOWERS_ONLY
  MUTUALS
  PRIVATE
}

enum StoryVisibility {
  EVERYONE
  FOLLOWERS_ONLY
  MUTUALS
  NO_ONE
}

model StoryView {
  // ─── Composite Identity ─────────────────────────────
  storyId  String
  viewerId String

  // ─── Metadata ───────────────────────────────────────
  viewedAt   DateTime @default(now())
  isPrivate  Boolean  @default(false) // Optional: for anonymous or restricted views
  isFlagged  Boolean  @default(false)
  flagReason String?
  location   String? // Optional: geo-tag for analytics
  device     String? // Optional: device type or platform

  // ─── Relations ──────────────────────────────────────
  story  Story @relation(fields: [storyId], references: [id])
  viewer User  @relation(fields: [viewerId], references: [id])

  // ─── Composite Primary Key ──────────────────────────
  @@id([storyId, viewerId])
  // ─── Indexes ────────────────────────────────────────
  @@unique([storyId, viewerId], name: "storyId_viewerId")
  @@index([viewerId])
  @@index([viewedAt])
}

model StoryHighlight {
  // ─── Identity ───────────────────────────────────────
  id      String @id @default(cuid())
  storyId String
  userId  String

  // ─── Lifecycle ──────────────────────────────────────
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  isDeleted Boolean   @default(false)
  deletedAt DateTime?

  // ─── Metadata ───────────────────────────────────────
  title      String? // Optional: highlight label or name
  coverImage String? // Optional: thumbnail or preview image
  isPinned   Boolean @default(false) // Optional: for prioritizing highlights

  // ─── Relations ──────────────────────────────────────
  story Story @relation(fields: [storyId], references: [id])
  user  User  @relation(fields: [userId], references: [id])

  // ─── Indexes ────────────────────────────────────────
  @@unique([storyId, userId])
  @@index([userId])
  @@index([createdAt])
  @@index([isPinned])
}

model StoryLike {
  // ─── Identity ───────────────────────────────────────
  id      String @id @default(cuid())
  storyId String
  userId  String

  // ─── Metadata ───────────────────────────────────────
  likedAt      DateTime  @default(now())
  userUsername String? // Optional: snapshot for UI rendering
  userImage    String? // Optional: avatar or profile image
  isRemoved    Boolean   @default(false) // Optional: for undo-like or soft delete
  removedAt    DateTime?
  device       String? // Optional: device type or platform
  location     String? // Optional: geo-tag for analytics

  // ─── Relations ──────────────────────────────────────
  story Story @relation(fields: [storyId], references: [id])
  user  User  @relation(fields: [userId], references: [id])

  // ─── Indexes ────────────────────────────────────────
  @@unique([userId, storyId])
  @@index([storyId])
  @@index([userId])
  @@index([likedAt])
}
